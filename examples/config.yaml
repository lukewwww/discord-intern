app:
  dry_run: false

logging:
  level: INFO
  file:
    path: "data/logs/community-intern.log"
    rotation:
      backup_count: 5

discord:
  token: "REPLACE_ME"
  message_batch_wait_seconds: 180
  message_grouping_window_seconds: 300
  team_member_ids: []

ai_response:
  llm:
    base_url: "https://bridge.crynux-as.xyz/v1/llm"
    api_key: "REPLACE_ME"
    model: "Qwen/Qwen2.5-7B-Instruct"
    vram_limit: 24
    structured_output_method: "function_calling" # "json_schema" if the model supports native JSON schema structured output, otherwise "function_calling" (default)
    timeout_seconds: 60
    max_retries: 2

  llm_enable_image: false
  llm_image_adapter: "OpenAIImageAdapter"
  image_download_timeout_seconds: 20
  image_download_max_retries: 2

  graph_timeout_seconds: 200

  enable_verification: false

  project_introduction: |
    Crynux Network is a permissionless decentralized AI computing network where nodes contribute GPUs to run LLM and Diffusion inference and training/fine-tuning tasks for applications.
    A blockchain-enforced consensus protocol and staking-based slashing verify results and deter fraud, while a relay handles off-chain task payloads and outputs.

    Design update (online docs not updated yet):
    The latest system design moves the end-to-end task workflow into the Relay, including task submission, scheduling, distribution, result submission, and validation.
    The Relay maintains a centralized Relay Account and all task fee settlement is handled inside the Relay.
    Applications deposit from supported L2 blockchains into the Relay Account, then submit tasks to the Relay.
    The Relay settles task fees to node Relay Accounts, and both nodes and applications can withdraw from their Relay Accounts to any supported L2 blockchain.
    This multi-L2 deposit and withdrawal system can also be used for cross-chain token transfers, such as moving assets from Crynux on Near to Crynux on Dymension.

    Main components (from online docs):
    - Nodes: run tasks, stake tokens, submit results, and earn rewards
    - Applications: create tasks, pay fees, and retrieve outputs
    - Blockchain: records tasks, node status, staking, and settlement events
    - Smart Contracts: implement task lifecycle, dispatching, pricing, validation, rewards, and slashing
    - Consensus Protocol: verifies results and penalizes malicious behavior
    - Relay: transports off-chain task parameters and results
    - Crynux Bridge: application middleware providing OpenAI-compatible LLM and image APIs
    - Crynux Portal: used by both application operators and node operators to manage wallets, credits, staking, and withdrawals across supported L2 networks

  gating_prompt: |
    You are a bot that acts as the community manager for the Crynux Network Discord server.

    This step is gating only. Do not answer the user.
    Decide whether the bot should reply to the user's last message.

    First decide whether the user's message is a question. If it is not a question, return should_reply as false.
    If it is a question, decide whether it is about Crynux Network.

    Reply only if the user's message is clearly about Crynux Network, including:
    - Node operations: starting a node, troubleshooting node errors, runtime issues.
    - Tokens and portal: deposits/withdrawals in the Crynux Portal, relay accounts, getting test tokens via Discord commands.
    - Blockchain setup: configuring Crynux L2 networks (Dymension and Near) in MetaMask and related connection issues.
    - Crynux system design: consensus protocol, task validation, quality of service, model distribution, staking, and task probability.

    Do not reply to general chit-chat, unrelated technical support, other projects, or personal requests.

  selection_prompt: |
    You are a bot that acts as the community manager for the Crynux Network Discord server.
    This step is source selection only. Do not answer the user.
    Select the most relevant sources from the index to answer the user query.
    Prefer sources that directly answer the question and contain concrete steps or definitions.

    Source ID rules:
    - Each entry in the index starts with a source_id on the first line.
    - Return source_id values exactly as they appear in the index.
    - source_id may be a URL (starts with https:// or http://) or a file path.
    - Do not convert URLs into file paths.
    - Do not add prefixes such as "data/knowledge-base/sources/".
    - Do not remove parts of the ID such as file extensions.
    - If you are not sure, select fewer sources rather than guessing.

  answer_prompt: |
    You are a bot that acts as the community manager for the Crynux Network Discord server.
    Answer the user's question using only the provided context.
    Only answer what was asked. Do not replace the answer with related information.

    If the provided context does not explicitly contain the information needed to answer the question, you must refuse by returning a null answer (a JSON null value, not a string "null").
    This includes cases where the context is relevant but does not directly confirm the specific fact the user asked about.

    Rules:
    - If the user provides an error log or screenshot, carefully analyze the specific details within it. Combine your own knowledge with the provided context to offer a specific solution. Do not simply repeat context if the user's error log or screenshot differs from what is described in the context.
    - If you're not sure the exact reason of the error, ask the user to provide log files, and then you stop there to wait for a reply from the team member. DO NOT give general guesses such as "anti-virus software".
    - If the user asks a yes or no question, answer yes or no only if the context explicitly states it. Otherwise return null.
    - Do not present capabilities, examples, or background as if they answer the question when they do not.
    - If the user question contains multiple parts and any required part is not explicitly answered in the context, return null.

  verification_prompt: |
    You are the community manager for the Crynux Network Discord server.
    Decide if the draft answer is safe, clear, and grounded.
    Reject answers that contain unsupported claims or are not grounded in the provided context.

  max_sources: 3

  max_answer_chars: 3000

kb:
  sources_dir: "data/knowledge-base/sources"
  index_path: "data/knowledge-base/index.txt"
  index_cache_path: "data/knowledge-base/index-cache.json"
  links_file_path: "data/knowledge-base/links.txt"

  llm: null

  web_fetch_timeout_seconds: 30
  web_fetch_cache_dir: "data/knowledge-base/web-cache"

  url_download_concurrency: 3
  summarization_concurrency: 5

  url_refresh_min_interval_hours: 72
  runtime_refresh_tick_seconds: 300
  file_watch_debounce_seconds: 2

  max_source_bytes: 2000000

  summarization_prompt: |
    Write a compact index description of the source content.
    Focus on coverage: list the main topics, concepts, systems, features, entities, and workflows mentioned.
    Do not paraphrase or retell the document; do not quote it.
    Keep it short, plain English, and oriented to when the source is relevant.

  team_raw_dir: "data/team-knowledge/raw"
  team_topics_dir: "data/team-knowledge/topics"
  team_index_path: "data/team-knowledge/index-team.txt"
  team_index_cache_path: "data/team-knowledge/index-team-cache.json"
  team_state_path: "data/team-knowledge/state.json"
  qa_raw_last_processed_id: ""

  team_classification_prompt: |
    You are a topic classifier for the Crynux team knowledge base.
    Given the current index of topics and a new Q&A pair, decide whether to add it to an existing topic, create a new one, or skip it entirely.

    First, evaluate whether the text conversation is self-contained and can guide future answers:
    - Set skip to true if the question uses vague references like "this error", "this issue", or "this problem" without describing what it is.
    - Set skip to true if the answer cannot be understood without additional context that is not present in the text.
    - Set skip to true if the conversation is greetings, casual chat, or off-topic discussion without technical content.

    If the conversation is self-contained and contains reusable knowledge:
    - Match it to an existing topic based on the main subject matter.
    - Create a new topic only if no existing topic covers the subject.
    - Use descriptive filenames like "node-startup-issues" or "token-deposits".

  team_integration_prompt: |
    You are integrating a new Q&A pair into an existing topic file for the Crynux team knowledge base.
    Analyze the existing Q&A pairs and the new one. Decide whether to:
    - Simply add the new Q&A pair
    - Remove obsolete Q&A pairs that the new one supersedes

    Guidelines:
    - Remove older pairs only if the new one provides updated or corrected information.
    - Keep pairs that cover different aspects even if related.
    - Preserve pairs with unique information not covered by the new one.

  team_summarization_prompt: |
    You are a file summarizer for the Crynux team knowledge base.
    Write a compact index description of this Q&A topic file.
    Focus on coverage: list the main questions and topics covered.
    Keep it short, plain English, and oriented to when the source is relevant.

  team_image_summary_prompt: |
    You summarize key information from images to support team conversations.
    Your goal is to extract every piece of information from the image that is used in or relevant to the conversation below.
    The summary must contain all details necessary for someone to fully understand the entire conversation's context and technical content without seeing the original image again.
    Preserve all technical details, error messages, configuration values, and visual elements referenced in the discussion.
