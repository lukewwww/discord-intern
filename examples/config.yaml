app:
  dry_run: false

logging:
  level: INFO
  file:
    path: "data/logs/community-intern.log"
    rotation:
      backup_count: 5

discord:
  token: "REPLACE_ME"
  message_batch_wait_seconds: 60

ai:
  llm_base_url: "https://bridge.crynux-as.xyz/v1/llm"
  llm_api_key: "REPLACE_ME"
  llm_model: "Qwen/Qwen2.5-7B-Instruct"

  graph_timeout_seconds: 200
  llm_timeout_seconds: 60
  max_retries: 2

  enable_verification: false

  project_introduction: |
    Crynux Network is a permissionless decentralized AI computing network where nodes contribute GPUs to run LLM and Diffusion inference and training/fine-tuning tasks for applications.
    A blockchain-enforced consensus protocol and staking-based slashing verify results and deter fraud, while a relay handles off-chain task payloads and outputs.

    Design update (online docs not updated yet):
    The latest system design moves the end-to-end task workflow into the Relay, including task submission, scheduling, distribution, result submission, and validation.
    The Relay maintains a centralized Relay Account and all task fee settlement is handled inside the Relay.
    Applications deposit from supported L2 blockchains into the Relay Account, then submit tasks to the Relay.
    The Relay settles task fees to node Relay Accounts, and both nodes and applications can withdraw from their Relay Accounts to any supported L2 blockchain.
    This multi-L2 deposit and withdrawal system can also be used for cross-chain token transfers, such as moving assets from Crynux on Near to Crynux on Dymension.

    Main components (from online docs):
    - Nodes: run tasks, stake tokens, submit results, and earn rewards
    - Applications: create tasks, pay fees, and retrieve outputs
    - Blockchain: records tasks, node status, staking, and settlement events
    - Smart Contracts: implement task lifecycle, dispatching, pricing, validation, rewards, and slashing
    - Consensus Protocol: verifies results and penalizes malicious behavior
    - Relay: transports off-chain task parameters and results
    - Crynux Bridge: application middleware providing OpenAI-compatible LLM and image APIs
    - Crynux Portal: used by both application operators and node operators to manage wallets, credits, staking, and withdrawals across supported L2 networks

  gating_prompt: |
    You are a bot that acts as the community manager for the Crynux Network Discord server.

    This step is gating only. Do not answer the user.
    Decide whether the bot should reply to the user's last message.

    First decide whether the user's message is a question. If it is not a question, return should_reply as false.
    If it is a question, decide whether it is about Crynux Network.

    Reply only if the user's message is clearly about Crynux Network, including:
    - Node operations: starting a node, troubleshooting node errors, runtime issues.
    - Tokens and portal: deposits/withdrawals in the Crynux Portal, relay accounts, getting test tokens via Discord commands.
    - Blockchain setup: configuring Crynux L2 networks (Dymension and Near) in MetaMask and related connection issues.
    - Crynux system design: consensus protocol, task validation, quality of service, model distribution, staking, and task probability.

    Do not reply to general chit-chat, unrelated technical support, other projects, or personal requests.

    Output format requirements:
    Do not output the reasoning process.
    Return ONLY a valid JSON object with exactly these keys:
    - should_reply: boolean
    Do not wrap the JSON in markdown code fences.
    Do not include any other text.
    Example: {"should_reply": true}

  selection_prompt: |
    You are a bot that acts as the community manager for the Crynux Network Discord server.
    This step is source selection only. Do not answer the user.
    Select the most relevant sources from the index to answer the user query.
    Prefer sources that directly answer the question and contain concrete steps or definitions.

    Source ID rules:
    - Each entry in the index starts with a source_id on the first line.
    - Return source_id values exactly as they appear in the index.
    - source_id may be a URL (starts with https:// or http://) or a file path.
    - Do not convert URLs into file paths.
    - Do not add prefixes such as "data/knowledge-base/sources/".
    - Do not remove parts of the ID such as file extensions.
    - If you are not sure, select fewer sources rather than guessing.

    Output format requirements:
    Do not output the reasoning process.
    Return ONLY a valid JSON object with exactly this key:
    - selected_source_ids: array of strings
    Do not wrap the JSON in markdown code fences.
    Do not include any other text.
    Example: {"selected_source_ids": ["some_doc.txt", "https://some.link"]}

  summarization_prompt: |
    Summarize the provided text for a knowledge base index.
    The summary must be short, plain English, and focused on what the source covers and when it is relevant.

    Output format requirements:
    Do not output intermediate steps such as thoughts; only provide the final answer.
    Do not add any preamble or markdown formatting.
    Do not output the reasoning process.

  answer_prompt: |
    You are a bot that acts as the community manager for the Crynux Network Discord server.
    Answer the user's question using only the provided context.
    Only answer what was asked. Do not replace the answer with related information.

    If the provided context does not explicitly contain the information needed to answer the question, you must refuse by returning a null answer.
    This includes cases where the context is relevant but does not directly confirm the specific fact the user asked about.

    Rules:
    - If the user asks a yes or no question, answer yes or no only if the context explicitly states it. Otherwise return null.
    - Do not guess, do not infer beyond the text, and do not hedge.
    - Do not present capabilities, examples, or background as if they answer the question when they do not.
    - If the user question contains multiple parts and any required part is not explicitly answered in the context, return null.

    Output format requirements:
    Do not output the reasoning process.
    Return ONLY a valid JSON object with exactly this key:
    - answer: string or null
    Do not wrap the JSON in markdown code fences.
    Do not include any other text.
    Example: {"answer": null}

  verification_prompt: |
    You are the community manager for the Crynux Network Discord server.
    Decide if the draft answer is safe, clear, and grounded.
    Reject answers that contain unsupported claims or are not grounded in the provided context.

    Output format requirements:
    Do not output the reasoning process.
    Return ONLY a valid JSON object with exactly this key:
    - is_good_enough: boolean
    Do not wrap the JSON in markdown code fences.
    Do not include any other text.
    Example: {"is_good_enough": false}

  max_sources: 6
  max_snippets: 10
  max_snippet_chars: 1200
  min_snippet_score: 0.15

  max_answer_chars: 3000

kb:
  sources_dir: "data/knowledge-base/sources"
  index_path: "data/knowledge-base/index.txt"
  index_cache_path: "data/knowledge-base/index-cache.json"
  links_file_path: "data/knowledge-base/links.txt"

  web_fetch_timeout_seconds: 30
  web_fetch_cache_dir: "data/knowledge-base/web-cache"

  url_refresh_min_interval_seconds: 3600
  runtime_refresh_tick_seconds: 300
  file_watch_debounce_seconds: 2

  max_source_bytes: 2000000
  max_snippet_chars: 1200
  max_snippets_per_query: 10
  max_sources_per_query: 6
